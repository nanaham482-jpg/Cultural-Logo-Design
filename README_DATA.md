# 图片数据管理说明

## 📁 数据文件位置

图片数据存储在 `data/images.json` 文件中。

## 📝 JSON文件格式

每个图片项包含以下字段：

```json
{
  "image_url": "图片的完整URL地址",
  "tags": ["标签1", "标签2", "标签3"],
  "status": "success"
}
```

## 🔄 如何更新图片数据

### 方法1：直接编辑JSON文件
1. 打开 `data/images.json` 文件
2. 添加或修改图片数据
3. 保存文件
4. 服务器会自动重新加载（开发模式）

### 方法2：批量导入
如果您有完整的JSON数据文件：
1. 将数据复制到 `data/images.json`
2. 确保JSON格式正确（数组格式）
3. 重启服务器（生产环境）

## 🔍 标签搜索机制

系统使用**匹配度评分系统**进行图片搜索，确保返回最相关的图片：

### 匹配规则

1. **精确匹配**（10分）
   - 图片标签与搜索关键词完全一致
   - 例如：搜索"清真寺"，图片标签包含"清真寺"

2. **部分匹配**（5分）
   - 图片标签包含搜索关键词
   - 搜索关键词包含图片标签（较短的关键词）
   - 例如：搜索"清真"，图片标签包含"清真寺"

3. **同义词匹配**（2-3分）
   - 仅在原始标签无法匹配时使用
   - 使用同义词映射表扩展匹配
   - 例如：搜索"伊斯兰"，匹配"清真寺"、"阿拉伯"等同义词

### 匹配要求

- **大小写不敏感**：匹配时不区分大小写
- **至少匹配一个原始标签**：要求至少匹配一个原始搜索标签（不是同义词）
- **按匹配度排序**：所有匹配的图片按匹配度降序排序
- **返回数量限制**：最多返回20张图片

### 同义词映射

系统内置了同义词映射表，支持以下类型的扩展匹配：
- 宗教/文化主题：伊斯兰、清真、佛教、寺庙等
- 建筑风格：传统、中式、藏式、古建筑等
- 装饰元素：彩绘、龙、莲花、经幡、法轮等
- 颜色：金色、蓝色、红色、绿色、灰色等

## 📊 示例

### 搜索示例

**示例1：单关键词搜索**
- 搜索关键词：`["清真寺"]`
- 匹配结果：
  - 精确匹配"清真寺"的图片（10分）
  - 包含"清真寺"的图片（5分）
  - 通过同义词"伊斯兰"匹配的图片（3分）
- 返回：按匹配度排序，最多20张

**示例2：多关键词搜索**
- 搜索关键词：`["清真寺", "蓝色"]`
- 匹配结果：
  - 同时包含"清真寺"和"蓝色"的图片（匹配度更高）
  - 包含"清真寺"或"蓝色"的图片
- 返回：按匹配度排序，最相关的图片排在前面

**示例3：同义词匹配**
- 搜索关键词：`["伊斯兰"]`
- 匹配结果：
  - 直接匹配"伊斯兰"的图片（10分）
  - 通过同义词匹配"清真寺"、"阿拉伯"等的图片（3分）

### 添加新图片
```json
{
  "image_url": "https://your-bucket.oss-cn-beijing.aliyuncs.com/path/to/image.jpg",
  "tags": ["新标签1", "新标签2", "新标签3"],
  "status": "success"
}
```

## ⚠️ 注意事项

1. **URL格式**：确保图片URL可以直接访问（公开或已签名）
2. **标签质量**：标签越准确，搜索结果越精确
3. **数据结构**：确保每个图片项都包含 `tags` 数组，且 `status` 为 "success"
4. **文件大小**：如果图片数据量很大（>1000张），建议考虑使用数据库
5. **性能**：当前实现适合中小规模数据（<500张图片）
6. **匹配精度**：系统会优先返回匹配度高的图片，避免返回无关图片

## 🚀 未来优化建议

如果图片数据量很大，可以考虑：
1. 使用数据库（如MongoDB、PostgreSQL）存储图片元数据
2. 实现标签索引以提高搜索性能
3. 添加图片缓存机制
4. 支持分页加载
5. 优化匹配算法，支持更复杂的查询（如AND/OR逻辑）
6. 添加标签权重系统，提高匹配精度

## 🔧 技术实现

图片搜索功能在 `lib/oss.ts` 中实现：
- `searchImagesByTags()`: 根据标签搜索图片
- 使用匹配度评分系统确保结果相关性
- 支持同义词扩展匹配
- 自动过滤无效数据（tags为空或非数组）


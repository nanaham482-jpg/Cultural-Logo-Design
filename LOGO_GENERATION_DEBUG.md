# Logo生成功能调试指南

## 📁 控制Logo生成的文件

Logo生成功能由以下文件控制：

### 1. 前端页面 (`app/page.tsx`)
- **位置**: `app/page.tsx` (第90-152行)
- **功能**: 
  - 接收用户输入的风格描述
  - 调用 `/api/generate-logo` API
  - 显示生成的Logo或错误信息

### 2. API路由 (`app/api/generate-logo/route.ts`)
- **位置**: `app/api/generate-logo/route.ts`
- **功能**:
  - 接收前端请求（imageUrl和styleDescription）
  - 调用 `generateLogo` 函数
  - 返回Logo URL或错误信息

### 3. AI服务 (`lib/ai.ts`)
- **位置**: `lib/ai.ts` (第92-210行)
- **功能**:
  - 调用通义千问图像生成API
  - 处理异步任务轮询
  - 返回生成的Logo URL

## 🔍 问题排查步骤

### 步骤1：检查浏览器控制台
1. 打开浏览器开发者工具（F12）
2. 切换到"Console"标签
3. 尝试生成Logo
4. 查看是否有错误信息

### 步骤2：检查服务器日志
1. 查看运行 `npm run dev` 的终端窗口
2. 查找以下日志：
   - `开始生成Logo，参数:` - 确认请求已到达API
   - `调用通义千问图像生成API` - 确认API调用开始
   - `API响应数据:` - 查看API返回的原始数据
   - `任务创建成功，task_id:` - 确认任务已创建
   - `轮询结果` - 查看轮询过程

### 步骤3：检查环境变量
确认 `.env.local` 文件中包含：
```env
QWEN_API_KEY=your-qwen-api-key
```

### 步骤4：测试API调用
如果问题仍然存在，检查：
1. API密钥是否有效
2. 通义千问API配额是否充足
3. 网络连接是否正常

## 🐛 常见问题

### 问题1：API返回401错误
**原因**: API密钥无效或过期
**解决**: 检查 `.env.local` 中的 `QWEN_API_KEY` 是否正确

### 问题2：任务创建失败
**原因**: API请求格式不正确
**解决**: 查看服务器日志中的"API响应数据"，检查返回格式

### 问题3：轮询超时
**原因**: 图像生成时间过长（超过60秒）
**解决**: 增加 `maxRetries` 值或检查API服务状态

### 问题4：获取不到task_id
**原因**: API响应格式与预期不符
**解决**: 查看日志中的"API响应数据"，可能需要调整代码以适配实际响应格式

## 📝 已添加的改进

1. ✅ **错误处理增强**: 前端和API都添加了详细的错误处理
2. ✅ **日志输出**: 添加了详细的日志，方便调试
3. ✅ **响应格式兼容**: 支持多种可能的API响应格式
4. ✅ **状态检查**: 前端会检查API响应状态码

## 🔧 如何查看详细日志

所有关键步骤都会在服务器控制台输出日志：
- API调用开始
- API响应数据（完整JSON）
- 任务ID
- 轮询过程
- 最终结果或错误

## 💡 下一步

如果问题仍然存在，请：
1. 复制服务器控制台的完整错误日志
2. 复制浏览器控制台的错误信息
3. 提供这些信息以便进一步诊断

